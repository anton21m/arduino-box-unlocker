# Описание проекта

Электромагнитный замок открывается при правильном срабатывании всех **6 RFID-считывателей**.

Для отображения состояния системы используется **четырёхразрядный семисегментный индикатор TM1637**.  
Индикатор предназначен для диагностики работы **6 RFID-считывателей** и состояния **реле замка**.

## Назначение сегментов

Каждый из четырёх разрядов индикатора состоит из 7 светодиодных сегментов.  
В системе задействовано **6 сегментов**, при этом **седьмой сегмент не используется и никогда не загорается**, поскольку всего применяется 6 RFID-считывателей.  

Каждый активный сегмент соответствует одному RFID-считывателю:
- **1-й сегмент** — 1-й считыватель  
- **...**  
- **6-й сегмент** — 6-й считыватель  

Когда все шесть считывателей находятся в корректном состоянии, на индикаторе отображается **значение “0”**, что означает нормальную работу системы.

## Назначение разрядов индикации

Индикация TM1637 отображает текущее состояние системы по разрядам:

- **1-й разряд** — считыватель исправен и получает данные  
- **2-й разряд** — RFID-карта вставлена  
- **3-й разряд** — карта вставлена в правильный считыватель  
- **4-й разряд** — состояние реле (включено / выключено, замок открыт / закрыт)

Метки `UID` задаются в файле:  
`src/config.ino`

# обрыв RFID датчика и симптомы

| Линия | Симптомы |
|-------|-----------|
| **CS**   | Карта не определяется, чип может зависнуть |
| **RST**  | Система продолжает работать, ошибок не наблюдается |
| **MOSI** | При обрыве чип не работает |
| **MISO** | При обрыве чип не работает |
| **SCK**  | При обрыве чип не работает |


# компоненты 
- 6 rfid меток 
- 1 магнит (будет подключаться через реле)

```
// я подключил так и работает
// aduino 
// gnd черный -> 8
// 3.3 v белый -> 6
// 13 желтый -> 2
// 12 зеленый -> 4
// 11 синий -> 3
// 10 розовый -> 7
// SDA (2-7) -> 1 (0-1 это служебные от arduino RX/TX)
```

# заметки по сборке 
1. Для заливки прошивки открыть папку `src` в Arduino Studio

2. Для сборки и тестирования в wokwi
```
alias arduino-cli=./bin/arduino-cli
make all
```

Install arduino uno
```
arduino-cli config init
arduino-cli core update-index
arduino-cli core install arduino:avr
arduino-cli compile --fqbn arduino:avr:uno arduino-bomba.ino --output-dir build
```

# Установка новых библиотек
```
arduino-cli lib install GyverTM1637
arduino-cli lib install "MFRC522"
```

# changlog релизов
- 18.02.2026 (1.5.1) Добавлено sspin отключение, и delay после инициализации
- 18.02.2026 (1.5) все переписано на "RFID_MFRC522v2", не используется rst pin теперь, тесты показали что ошибки связи есть, но они восстанавливаются через 2-3 секунды, тоесть сейчас устройство работает стабильно, без отказов
- 16.02.2026 (1.4) 
    - Добавленая индикация свтодиодов для показа ошибки (быстрое моргание), 
    - добавлен reset датчиков только в случае неполадки
    - Убран счетчик инициализаций, инициализаци будет бесконечная в случае ошибки
    - убран PCD_Init, и сброс на каждой итерации
- 04.02.2026 (1.3) добавлены для индикации 2 светодиода (красный и голубой) с резистором 200 ОМ и их blink для отображения статуса вставки правильной карточки и решения головоломки. внедрен совет от alexgyver по сбросу состояния датчиков каждую 1-2 секунды
- 28.01.2026 (1.2) добавлена строгая проверка и бесконечная инициализация в случае неудачи, реле закрывает замок только после успешной инициализации всех датчиков.
- 26.01.2026 (1.1) заменен блок питания на зарядку usb-type-b, добавлен reset на 2 секунды. Также добавлен поднятие sspins перед каждой попыткой для уменьшения шума.
- 14.11.2025 Добавлены 2 чипа 74hct125 для стабильности, залиты все соединения горячим клеем.
- 19.08.2025 (1.0) Первая версия, глючная
